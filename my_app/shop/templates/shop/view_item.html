{% extends 'main.html' %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<script src="{% static 'js/view_item.js' %}"></script>

<body>
    <!-- Product section-->
    <section class="py-5">
        <div class="container px-4 px-lg-5 my-5">
            <div class="row gx-4 gx-lg-5 align-items-center">
                <div class="col-md-6">
                    <div class="img-box">
                        <img class="card-img-top mb-5 mb-md-0" style="    width: 300px;
                        height: auto;" src="{{ item.image.url }}" alt="{{ item.name }}" />
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="small mb-1">SKU: BST-498</div>
                    <h1 class="display-5 fw-bolder">{{ item.name }}</h1>
                    <div class="fs-5 mb-5">
                        <span class="text-decoration-line-through">$45.00</span>
                        <span>$ {{ item.price }}</span>
                    </div>
                    <p class="lead">{{ item.description }}</p>
                    <div class="d-flex">
                        <p>
                            <button type="button" class="btn btn-default btn-sm" id="decrease">
                                <span class="glyphicon glyphicon-minus"></span>
                            </button>
                            <input type="number" id="quantity" value="1" min="1" step="1"
                                style="width: 50px; text-align: center;">
                            <button type="button" class="btn btn-default btn-sm" id="increase">
                                <span class="glyphicon glyphicon-plus"></span>
                            </button>
                            <button type="button" class="btn btn-default btn-sm" id="add-to-cart"
                                data-item-id="{{ item.id }}">
                                <span class="glyphicon glyphicon-shopping-cart"></span>
                                <b> Add to Cart </b>
                            </button>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Related items section-->
    {% include 'shop/related_pro.html' %}
    <!-- Footer-->
    <div class="container-message" style="margin-top:20px;">
        <div class="message-section">
            <div class="message-form">
                <form method="POST" action="{% url 'item' item.pk %}">
                    {% csrf_token %}
                    <div class="send-mes">
                        <input type="text" name="body" placeholder="Type your message here">
                        <button type="submit" class="btn-submit">Send Message</button>
                    </div>

                </form>
            </div>

            <div class="mess-p">
                <h3>Messages:</h3>
                <ul>
                    {% for message in item_messages %}
                    <li>Name: {{ message.user }}</li>
                    <li>Message: {{ message.body }}</li>
                    {% if message.user == request.user %}
                    <form method="POST" action="{% url 'delete-message' message.pk %}">
                        {% csrf_token %}
                        <button type="submit" class="btn-delete">Delete</button>
                    </form>
                    {% endif %}
                    <hr>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
    <section class="info_section  layout_padding2-top">
        <div class="social_container">
            <div class="social_box">
                <a href="">
                    <i class="fa fa-facebook" aria-hidden="true"></i>
                </a>
                <a href="">
                    <i class="fa fa-twitter" aria-hidden="true"></i>
                </a>
                <a href="">
                    <i class="fa fa-instagram" aria-hidden="true"></i>
                </a>
                <a href="">
                    <i class="fa fa-youtube" aria-hidden="true"></i>
                </a>
            </div>
        </div>
        <div class="info_container ">
            <div class="container">
                <div class="row">
                    <div class="col-md-6 col-lg-3">
                        <h6>
                            ABOUT US
                        </h6>
                        <p>
                            Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed doLorem ipsum dolor sit amet,
                            consectetur
                            adipiscing elit, sed doLorem ipsum dolor sit amet,
                        </p>
                    </div>
                    <div class="col-md-6 col-lg-3">
                        <div class="info_form ">
                            <h5>
                                Newsletter
                            </h5>
                            <form action="#">
                                <input type="email" placeholder="Enter your email">
                                <button>
                                    Subscribe
                                </button>
                            </form>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-3">
                        <h6>
                            NEED HELP
                        </h6>
                        <p>
                            Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed doLorem ipsum dolor sit amet,
                            consectetur
                            adipiscing elit, sed doLorem ipsum dolor sit amet,
                        </p>
                    </div>
                    <div class="col-md-6 col-lg-3">
                        <h6>
                            CONTACT US
                        </h6>
                        <div class="info_link-box">
                            <a href="">
                                <i class="fa fa-map-marker" aria-hidden="true"></i>
                                <span> Gb road 123 london Uk </span>
                            </a>
                            <a href="">
                                <i class="fa fa-phone" aria-hidden="true"></i>
                                <span>+01 12345678901</span>
                            </a>
                            <a href="">
                                <i class="fa fa-envelope" aria-hidden="true"></i>
                                <span> demo@gmail.com</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- footer section -->
        <footer class=" footer_section">
            <div class="container">
                <p>
                    &copy; <span id="displayYear"></span> All Rights Reserved By
                    <a href="https://html.design/">Free Html Templates</a>
                </p>
            </div>
        </footer>
    </section>
</body>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
    $(document).ready(function () {
        $('#increase').click(function () {
            let quantity = parseInt($('#quantity').val());
            $('#quantity').val(quantity + 1);
        });

        $('#decrease').click(function () {
            let quantity = parseInt($('#quantity').val());
            if (quantity > 1) {
                $('#quantity').val(quantity - 1);
            }
        });

        $('#add-to-cart').click(function () {
            let itemId = $(this).data('item-id');
            let quantity = $('#quantity').val();

            $.ajax({
                url: "{% url 'add_to_cart' 0 %}".replace('0', itemId),
                method: 'POST',
                data: {
                    'quantity': quantity,
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                },
                success: function (response) {
                    alert("Item added to cart successfully!");
                },
                error: function (response) {
                    alert("Failed to add item to cart.");
                }
            });
        });
    });
</script>

{% endblock content %}